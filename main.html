<!DOCTYPE html>
<html>
  <head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <title>MineForces</title>
    <link rel="stylesheet" type="text/css" href="./css/bootstrap.min.css">
    <link rel="stylesheet" type="text/css" href="./css/bootstrap-theme.min.css">
  </head>
  <body>
    <div id="message" class="container" style="padding-top: 50px;">
      <div class="row">
        Total solved:
      </div>
      <div class="row">
        <div class="progress">
          <div id="total_solved" class="progress-bar progress-bar-success progress-bar-striped" style="width: 0%;">
          </div>
        </div>
      </div>
      <div class="row">
        <div class="container" id="tag_table">
        </div>
      </div>
    </div>
    <script src="./js/jquery.min.js"></script>
    <script src="./js/bootstrap.min.js"></script>
    <script>
      var crawler = require('./js/crawler.js');
      crawler = new crawler.Crawler();
      crawler.load(onProblemLoad);
      //crawler.pullProblems(onProblemLoad);
      
      function onProblemLoad(problems) {
        var accepted = 0;
        var total = 0;
        for (var key in problems) {
          if (problems[key].accepted) {
            ++accepted;
          }
          ++total;
        }
        $('#total_solved').text(accepted + '/' + total);
        $('#total_solved').css('width', Math.floor(100 * accepted / total) + '%');
        var tagCnt = {};
        for (var key in problems) {
          for (var i in problems[key].tags) {
            var tag = problems[key].tags[i];
            if (!(tag in tagCnt)) {
              tagCnt[tag] = [0, 0];
            }
            if (problems[key].accepted) {
              ++tagCnt[tag][0];
            }
            ++tagCnt[tag][1];
          }
        }
        var maxTagCnt = 500;
        for (var tag in tagCnt) {
          var html = '<div class="row">';
          var width = Math.floor(100 * tagCnt[tag][0] / tagCnt[tag][1]);
          html += '<span class="col-md-3">' + tag + '</span>';
          html += '<span class="col-md-9"><div class="progress"><div class="progress-bar progress-bar-information progress-bar-striped" style="width: ' + width + '%;">' + tagCnt[tag][0] + ' / ' + tagCnt[tag][1] + '</div></div></span>';
          html += '</div>';
          $('#tag_table').append(html);
        }
        var selected = [];
        var diff = [5000, 4000, 3000, 2000, 1000, 500, 200, 100];
        for (var k = 0; k < 20; ++k) {
          var select = [];
          var tags = [];
          for (var i = 0; i < diff.length; ++i) {
            var current = '';
            for (var key in problems) {
              if (selected.indexOf(key) > -1) {
                continue;
              }
              if (select.indexOf(key) > -1) {
                continue;
              }
              if (problems[key].acceped) {
                continue;
              }
              if (key.length !== 4) {
                continue;
              }
              if (problems[key].tags.indexOf('implementation') > -1) {
                continue;
              }
              if (problems[key].tags.indexOf('brute force') > -1) {
                continue;
              }
              if (problems[key].solved <= diff[i]) {
                if (current === '' || problems[current].solved < problems[key].solved) {
                  current = key;
                }
              }
            }
            if (current === '') {
              break;
            }
            select.push(current);
            for (var j in problems[current].tags) {
              if (tags.indexOf(problems[current].tags[j]) < 0) {
                tags.push(problems[current].tags[j]);
              }
            }
          }
          if (select.length + 3 < diff.length) {
            break;
          }
          $('#message').append((k + 1) + ':<br/>');
          for (var j in select) {
            selected.push(select[j]);
            $('#message').append(select[j] + ' ');
          }
          $('#message').append('<br/>');
          for (var j in select) {
            $('#message').append(problems[select[j]].solved + ' ');
          }
          $('#message').append('<br/>');
          for (var j = 0; j < tags.length; ++j) {
            if (j > 0) {
              $('#message').append(', ');
            }
            $('#message').append(tags[j]);
          }
          $('#message').append('<br/>');
          $('#message').append('<br/>');
        }
        $('#message').append('<hr/>');
        var tags = {};
        for (var key in problems) {
          if (!problems[key].accepted && problems[key].solved >= 200 && key.length == 4) {
            for (var i in problems[key].tags) {
              var tag = problems[key].tags[i];
              if (!(tag in tags)) {
                tags[tag] = [];
              }
              tags[tag].push(key);
            }
          }
        }
        selected = [];
        for (var k = 0; k < 7; ++k) {
          for (var tag in tags) {
            while (tags[tag].length > 0) {
              if (selected.indexOf(tags[tag][0]) == -1) {
                $('#message').append(tags[tag][0] + ' ');
                tags[tag].shift();
                break;
              }
              tags[tag].shift();
            }
          }
          $('#message').append('<br/>');
        }
      }
    </script>
  </body>
</html>